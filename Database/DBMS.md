# DBMS

## DBMS内部组成结构

### DBMS的内核【只接受SQL语句】

- 编译器（语法分析器）
- 授权检查
- 语义分析和查询处理
- 访问管理、并发控制、恢复模块【物理层】
  - 实现了关系模型的各种概念
  - 直接和操作系统打交道

UFI 提供给用户的即席访问接口

API 由数据库系统提供给数据库的各种使用方法

### DBMS运行状态下的进程结构

#### 单进程结构

-  把应用程序的代码和DBMS核心代码连接在一起，运行后就是一个单一的进程

#### 多进程结构【满足多用户多任务】、多线程结构

- 将DBMS核心进程和应用程序的进程分开，当应用进程要访问数据库时，应用程序的进程进程CONNECT时向系统发出请求，系统建立一个对应的DBMS核心进程，并在两个进程间建立通信的管道。
  - 问题：
    - 当系统访问的应用程序很多时，会导致由过多的DBMS核心进程，会导致电脑的性能变差
  - 为了解决此问题，创建线程
- DBMS进程的结构
- 公共空间
  - DAEMON 
    - 监听数据库连接请求的端口号
    - 为成功建立连接的应用程序建立DBMS核心线程
  - catlog 目录
    - 关于数据的数据
  - locktable 封锁表
    - 用来控制对锁的申请
  - buffer 
    - 缓冲区

## DBMS的物理层实现【访问管理】

- 物理层的主要工作：把对数据库的访问转化成在操作系统层的物理的数据结构的访问

### 访问类型

#### 查询一个文件的大部分元组

- 判定标准：查询设计的元组数占该关系总元组数的15%以上
- 以15%为标准的原因：硬盘是块设备，数据库存储在硬盘上，以物理块为单位读写，当占了15%，那么要访问该关系的全部的物理块。

#### 查找某条特定元组

#### 查找若干条元组【不超过15%】

#### 范围查询

#### 更新

### 文件组织

#### 堆文件

- 最常见、最基础的文件组织方式
- 随着数据写入不停向文件尾部写
- 查找方式：顺序扫描
- 适用于：查询一个文件的大部分元组

#### Hash文件

- 用户在查询时效率更快
- 对特定属性值建立HASH函数

#### 堆文件+B加树索引

- 将关系存为堆文件上，在某属性上加上b+树索引

#### 动态Hash

#### 栅格结构文件

#### RAW DISK机制/Clustering （簇集存储）

- 允许用户自己控制数据在磁盘上如何存储
- DBMS自己做了一个文件管理

### 索引

- b+树  【常用】
- 簇集索引  【常用】
- 倒排文件
- 动态hash
- 三则文件【以多维数组存储】、分区hash

### 访问原语

## 查询优化

- 对可能的代价进行代价估算找出一个好的策略

#### 代数优化

- 把用户提交的初始查询改写成等价的效率更高的形式

DBMS内部会用关系代数表达查询，通过分析器生成查询树。

- 代数优化对原来生成的查询树进行变化，把一元操作尽量往叶端下压，从而减小二元操作的规模

##### 相关概念

- 查询树
  - 叶子结点表示关系，中间结点表示一个操作，从叶结点到根的顺序就是一个执行顺序
- 等价变换规则
  - 连接和笛卡尔乘积的交换律
    - 代数优化的时候连接或笛卡尔乘积操作的左右子树可以交换
  - 连接和笛卡尔乘积的结合律
    - 代数优化的时候连接或笛卡尔乘积操作时可以旋转
  - 投影操作的串接律
  - 选择操作的串接律
  - 选择与投影操作的交换律
  - 选择的条件只与单个表有关，可以把选择的操作压到连接操作的下面
  - 附和并兼容的可以压下去

##### 基本原则

- 运用等价变换规则把一元操作尽量往叶端下压
- 寻找并且合并公共子表达式

#### 操作优化

- 找到最有效的计算方法实现操作

##### 选择操作的优化

##### 投影操作的优化

##### 集合操作的优化

##### 连接操作的优化

###### 嵌套循环的改进【？？】

- 内循环和外循环

- 基于磁盘是块访问，由于CPU运算速度比I/O存取速度块的多。
- 每次I/O取一个物理块，用块的内容遍历块的内容进行

- 为什么只给一个缓冲区给内循环？
  - 

###### 归并扫描算法

###### B+树索引

##### 组合操作的优化



## 事务管理

### 实现并发控制

### 恢复

- 出现软硬件故障导致数据库数据一致性的问题